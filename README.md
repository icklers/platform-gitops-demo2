# IDP Tutorial: Building a Production-Ready Platform with Crossplane and ArgoCD

Welcome to the Internal Developer Platform (IDP) tutorial. This repository contains a complete, hands-on guide to building a production-ready, multi-cloud platform using Crossplane for infrastructure-as-code and ArgoCD for GitOps delivery.

This project is designed for Senior DevOps Engineers who are already comfortable with Kubernetes and want to master the art of platform engineering.

## Full Documentation

The complete, detailed documentation for this tutorial is generated by MkDocs and can be found in the `/docs` directory. 

**➡️ [Next Section: Repository Management](./docs/repository-management/01-multi-repo-strategy.md)**

## Prerequisites

Before you begin, ensure you have the following:

-   A GitHub account.
-   Access to an Azure, GCP, or Hetzner cloud account (optional, but required for provider-specific exercises).
-   [Nix](https://nixos.org/download.html) and [Devbox](https://www.jetpack.io/devbox/docs/installing-devbox/) installed on your local machine (Linux or macOS).

For detailed setup instructions, please see the **[Getting Started Guide](./docs/getting-started/01-introduction.md)**.

## VS Code Configuration (Important)

This repository contains configuration for the Gemini Code Assist extension in the `.vscode/mcp.json` file. This allows the assistant to have long-term memory about our project.

After you clone this repository, you **must** update the `mcp.json` file to point to the absolute path of the `.memory` directory on your local machine.

1.  Open `.vscode/mcp.json`.
2.  Find the line containing `e:\Dev\idp-tutorial\.memory:/data`.
3.  Replace `e:\Dev\idp-tutorial` with the absolute path to where you have cloned this repository.

**Example:** If you cloned the repository to `/home/user/projects/idp-tutorial`, the new line should be `"-v", "/home/user/projects/idp-tutorial/.memory:/data",`.

## Quick Start: Bootstrapping the Environment

These steps will get your local learning environment up and running. 

### 1. Create Your Platform GitOps Repository

This tutorial provides the content for your "Platform GitOps Repo". You will create a new GitHub repository and push this content to it.

1.  **Clone this tutorial repository** to your local machine:

    ```bash
    gh repo clone icklers/idp-tutorial
    cd idp-tutorial
    ```

2.  **Create your new Platform GitOps Repo on GitHub** and push the content. This command will create a new public repository on GitHub (e.g., `my-platform-gitops-repo`), push the current directory's content to it, and set it as the `origin` remote.

    ```bash
    # Replace <your-repo-name> with your desired repository name (e.g., my-platform-gitops-repo)
    gh repo create <your-repo-name> --public --source . --remote origin
    ```

This repository (`<your-repo-name>`) will now be your source of truth for all GitOps configurations.

### 2. Activate the Development Environment

This command uses Nix and Devbox to install the exact versions of all the tools required for this tutorial.

```bash
devbox shell
```

### 3. Install Project Tools

Run the `setup-tools` script to install the Crossplane CLI and Python dependencies for MkDocs:

```bash
devbox run setup-tools
```

### 4. Create the Local Kubernetes Cluster

This command creates a local Kubernetes-in-Docker (KinD) cluster that will serve as our platform's control plane.

```bash
kind create cluster --config gitops-bootstrap/kind-cluster/kind-cluster.yaml
```

### 5. Bootstrap ArgoCD

This is the only manual step. First, we create the namespace for ArgoCD. Then, we apply the official installation manifest directly from the ArgoCD project's GitHub repository. This is the recommended way to ensure you are installing a stable and complete version of ArgoCD.

Finally, we apply our `platform-core.yaml` to tell our new ArgoCD instance to start managing our platform from Git.

```bash
# Create the namespace for ArgoCD
kubectl create namespace argocd

# Apply the official ArgoCD installation manifest
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

# The platform-core.yaml manifest needs to point to your new GitOps repository.
# Set your repository URL as an environment variable and use `sed` to update the file.
export PLATFORM_GITOPS_REPO_URL="https://github.com/your-username/your-repo-name.git" # <-- REPLACE THIS
sed -i "s|__YOUR_PLATFORM_GITOPS_REPO_URL__|$PLATFORM_GITOPS_REPO_URL|g" gitops-bootstrap/argocd/platform-core.yaml

# Apply the Platform Core ApplicationSet to start the GitOps sync
kubectl apply -f gitops-bootstrap/argocd/platform-core.yaml
```

### 6. Access ArgoCD

Your entire platform is now being created via GitOps. You can watch it happen in the ArgoCD UI.

```bash
# Get the initial admin password
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d; echo

# Port-forward the ArgoCD server
kubectl port-forward svc/argocd-server -n argocd 8080:443
```

You can now log in to `https://localhost:8080` with username `admin` and the password you just retrieved.

## Next Steps

Your environment is now fully bootstrapped. To understand what you've built and how to use your new platform, please proceed to the **[full tutorial documentation](./docs/index.md)**.
